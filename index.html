<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AdBlue Sygic Style</title>
</head>
<body style="font-family: Arial; padding: 20px; text-align: center;">
    <div style="border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
        <h2>⛽ Carga AdBlue</h2>
        <p id="v-info">Detectando vehículo...</p>
        <input type="number" id="litros" placeholder="Litros" style="width: 80%; padding: 10px; margin: 10px 0;">
        <button id="btn-save" style="width: 85%; padding: 15px; background: #004a99; color: white; border: none; border-radius: 5px; font-weight: bold;">GUARDAR</button>
    </div>

    <script>
        geotab.addin.adblue_sygic_style = function (api, state) {
            return {
                initialize: function (api, state, callback) {
                    const btn = document.getElementById('btn-save');
                    const info = document.getElementById('v-info');
                    const device = state.device || state.activeDevice;

                    if (device) {
                        info.innerHTML = "Vehículo: <b>" + (device.name || device.id) + "</b>";
                    }

                    btn.addEventListener('click', function() {
                        const litros = document.getElementById('litros').value;
                        if (!litros || !device) return alert("Faltan datos");

                        btn.disabled = true;
                        btn.innerText = "Enviando...";

                        api.call("Add", {
                            typeName: "MaintenanceRecord",
                            entity: {
                                device: { id: device.id },
                                maintenanceType: { id: "KnownIdMaintenanceTypeOilChangeId" },
                                notes: "Carga AdBlue: " + litros + "L",
                                dateTime: new Date().toISOString()
                            }
                        }, function() {
                            alert("¡Guardado con éxito!");
                            btn.disabled = false;
                            btn.innerText = "GUARDAR";
                        }, function(err) {
                            alert("Error: " + err.message);
                            btn.disabled = false;
                        });
                    });
                    callback();
                },
                focus: function (api, state) {},
                blur: function (api, state) {}
            };
        };
    </script>
</body>
</html>
